# コードレビュー

変更されたファイルをレビューし、以下のチェックリストに基づいて問題点や改善点を報告してください。

## レビュー対象

$ARGUMENTS

（引数がない場合は `git diff --name-only HEAD~1` で最新コミットの変更ファイルを確認）

---

## チェックリスト

### 1. コードスタイル

- [ ] RuboCop Omakaseプリセットに準拠しているか
- [ ] `frozen_string_literal: true` マジックコメントがあるか（Rubyファイル）
- [ ] インデントは2スペースか（Ruby）/ 2スペースか（JS）
- [ ] 不要な空白行やトレイリングスペースがないか
- [ ] 命名規則に従っているか（snake_case for Ruby, camelCase for JS）

### 2. セキュリティ

- [ ] SQLインジェクションの脆弱性がないか（直接SQL文字列結合を避ける）
- [ ] XSS脆弱性がないか（`html_safe`や`raw`の不適切な使用）
- [ ] マスアサインメント脆弱性がないか（Strong Parametersの適切な使用）
- [ ] 認証・認可のチェックが適切か（`require_authentication`の使用）
- [ ] 機密情報（APIキー、トークン）がハードコードされていないか
- [ ] ユーザー入力のバリデーションが適切か

### 3. パフォーマンス

- [ ] N+1クエリが発生していないか（`includes`/`preload`の使用）
- [ ] 不要なデータベースクエリがないか
- [ ] 重い処理がリクエストサイクル内で実行されていないか
- [ ] 適切なインデックスが設定されているか（マイグレーション）

### 4. アーキテクチャ

- [ ] コントローラーが肥大化していないか（ビジネスロジックはサービスへ）
- [ ] モデルの責務が適切か（単一責任の原則）
- [ ] サービスオブジェクトが適切に使用されているか
- [ ] Stimulusコントローラーのパターンに従っているか

### 5. テスト

- [ ] 新機能・変更に対するテストが追加されているか
- [ ] エッジケースがテストされているか
- [ ] テストが意味のあるアサーションを持っているか
- [ ] フィクスチャ/ファクトリーが適切に使用されているか

### 6. データベース

- [ ] マイグレーションが可逆であるか（`change`または`up`/`down`）
- [ ] 新規モデルはUUIDプライマリキーを使用しているか
- [ ] 外部キー制約が適切に設定されているか
- [ ] デフォルト値が適切に設定されているか

### 7. エラーハンドリング

- [ ] 例外が適切にキャッチ・処理されているか
- [ ] ユーザーへのエラーメッセージが適切か
- [ ] ログ出力が適切か（機密情報を含まない）

### 8. ドキュメント

- [ ] 複雑なロジックにコメントがあるか
- [ ] パブリックAPIにドキュメントがあるか（必要な場合）
- [ ] `docs/spec.md`の更新が必要か

---

## 出力形式

レビュー結果を以下の形式で報告してください：

### 🔴 重大な問題（マージ前に修正必須）
- ファイル名:行番号 - 問題の説明

### 🟡 改善推奨（修正が望ましい）
- ファイル名:行番号 - 改善点の説明

### 🟢 良い点
- 良かった実装やパターンの使用

### 💡 提案
- リファクタリングや将来の改善案
